<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/favicon.png">
  	<link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>לימוד עברית</title>
    <style>
        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            background-image: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }
        h1 {
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
            width: 100%;
            max-width: 600px;
        }
        .controls > div {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        label {
            font-size: 16px;
            color: #555;
        }
        select, .nav-button, .font-size-button {
            padding: 4px 8px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            flex: 1;
            border: 1px solid #ff9900;
            height: 36px;
        }
        #random-all-button {
            min-width: 120px; /* Added to ensure "Random All" fits on one line */
        }
        select + .controls div::after {
            content: '\25BC';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #ff9900;
        }
        select:focus, .nav-button:hover, .font-size-button:hover {
            background-color: #fff9e6;
            border-color: #ff6600;
        }
        .font-size-button {
            width: 30px;
            height: 30px;
            text-align: center;
            font-size: 20px;
        }
        .flashcard-container {
            perspective: 1000px;
            width: 520px;
            height: 320px;
            position: relative;
        }
        .flashcard {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        .flashcard-side {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border: 2px solid #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
        }
        :root {
            --main-color: #1a5d8c;
            --darker-color: #012d68;
        }
        .flashcard-front {
            font-size: 56px;
            font-weight: bold;
            color: white;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: linear-gradient(to bottom right, var(--main-color), var(--darker-color));
            border: 2px solid var(--main-color);
        }
        .flashcard-back {
            transform: rotateY(180deg);
            font-size: 24px;
            background-color: #fff;
            color: #333;
        }
        .navigation {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            margin-top: 20px;
            gap: 10px;
        }
        @media (max-width: 500px) {
            select, .nav-button, .font-size-button {
                padding: 6px 8px;
                font-size: 14px;
                height: 32px;
            }
            #random-all-button {
                min-width: 100px; /* Slightly smaller for mobile but still prevents wrapping */
            }
            .flashcard-container {
                width: 100%;
                height: 260px;
            }
            .flashcard-front {
                font-size: 48px;
                font-family: 'Alef', 'Noto Serif', sans-serif;
                direction: rtl;
                text-align: right;
            }
            .flashcard-back {
                font-size: 18px;
            }
        }
        .progress {
            margin-top: 10px;
            font-size: 16px;
            color: #555;
        }
        /* Define CSS classes for each font */
        .font-default { font-family: Arial, sans-serif; }
        .font-alef { font-family: 'Alef', sans-serif; }
        .font-noto { font-family: 'Noto Serif', sans-serif; }
        .font-varela { font-family: 'Varela Round', sans-serif; }
        .font-custom { font-family: 'CustomHebrewFont', sans-serif; }
        .font-custom-ttf { font-family: 'CustomTTFHebrewFont', sans-serif; }
        .font-nikkud { font-family: 'Frank Ruehl CLM', sans-serif; font-feature-settings: "liga" 0; }
        .font-rashi { font-family: 'Noto Rashi', sans-serif; }
        .font-dorian { font-family: 'DorianCLM-BookItalic', sans-serif; }
        .font-ktavyad { font-family: 'KtavYadCLM-MediumItalic', sans-serif; }
        .font-hadasim { font-family: 'Hadasim CLM', sans-serif; }
        .flashcard-front.font-ktavyad { font-size: 36px; }
        .flashcard-back.font-ktavyad { font-size: 18px; }
        /* Style for the checkbox */
        #nikkud-checkbox {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            border: 2px solid #555;
            border-radius: 4px;
            outline: none;
            background-color: #f0f0f0;
            cursor: pointer;
            vertical-align: middle;
        }
        #nikkud-checkbox:checked {
            background-color: #555;
            border: 2px solid #555;
        }
        #nikkud-checkbox:checked::after {
            content: '\2713';
            font-size: 14px;
            display: block;
            text-align: center;
            color: white;
            line-height: 18px;
        }
        
        .font-size-controls {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        .font-size-button {
            width: 30px;
            height: 30px;
            border: 2px solid #555;
            border-radius: 4px;
            background: #f0f0f0;
            color: #555;
            font-size: 20px;
            cursor: pointer;
            text-align: center;
            line-height: 0px;
            transition: background-color 0.3s;
        }
        .font-size-button:hover {
            background-color: #ddd;
        }
        .flashcard-back .usage-hebrew {
            position: relative;
            cursor: pointer;
        }
        .flashcard-back .usage-hebrew .usage-english {
            visibility: hidden;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            color: #333;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 100%;
            left: 50%;
            margin-left: -50%;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .flashcard-back .usage-hebrew:hover .usage-english {
            visibility: visible;
            opacity: 1;
        }
        .email-button {
            background: none;
            border: none;
            font-size: 24px;
            padding: 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .email-button:hover {
            transform: scale(1.2);
        }
        /* Menu container styles */
        .menu-container {
            flex: 1;
            max-width: 400px;
            position: relative;
        }
        .menu-header {
            background-color: #fff;
            color: #333;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border: 1px solid #ff9900;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .menu-header:hover {
            background-color: #fff9e6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .menu-content {
            display: none;
            position: absolute;
            width: 100%;
            background-color: #fff;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border: 1px solid #ff9900;
            border-radius: 5px;
            top: 100%;
            left: 0;
            margin-top: 5px;
        }
        .menu-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #ff9900;
            display: flex;
            align-items: center;
            transition: background-color 0.3s;
        }
        .menu-item:hover {
            background-color: #e6e6e6;
        }
        .menu-item:last-child {
            border-bottom: none;
        }
        .menu-title {
            color: #333;
            flex: 1;
            margin-right: 10px;
        }
        .submenu-select {
            width: 100%;
            padding: 5px;
            border: 1px solid #ff9900;
            border-radius: 4px;
            display: none;
            position: relative;
            z-index: 2;
        }
        .top-controls {
            width: 100%;
          	max-width: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 20px;
            position: relative;
        }
        .font-and-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .font-and-checkbox select {
            flex: 1; /* Ensures the select takes up the remaining space */
        }

        .checkbox-stack {
            display: flex;
            flex-direction: column;
            gap: 5px; /* Space between the two checkbox rows */
        }

        .checkbox-inline {
            display: flex;
            align-items: center;
        }

        .checkbox-inline label {
            margin-right: 5px; /* Space between label and checkbox */
        }
        .checkbox-inline input[type="checkbox"] {
            vertical-align: middle;
            margin-top: 0; /* Ensure no extra margin on top */
        }
        @media (max-width: 500px) {
            .top-controls {
                flex-direction: column;
                align-items: center;
            }
            .menu-container, .font-and-checkbox {
                width: 100%;
                max-width: 100%;
            }
        }
        .menu-container:hover .menu-content, 
        .menu-container:active .menu-content {
            display: block;
        }
        .word-list {
            width: 100%;
            max-width: 400px;
            margin: 20px 0;
            padding: 20px;
            background-color: transparent;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .word-list p {
            color: #888;
            text-align: justify;
            text-justify: inter-word;
        }
        .word-list ul {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .word-list li {
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .word-list li:last-child {
            border-bottom: none;
        }
        .word-list span {
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .word-list span:hover {
            color: #555;
        }
        .flashcard-back img {
            max-height: 150px; /* Adjust this value to fit your design */
        }
        #labels-checkbox {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            border: 2px solid #555;
            border-radius: 4px;
            outline: none;
            background-color: #f0f0f0;
            cursor: pointer;
            vertical-align: middle;
            margin-left: 5px; /* To align with nikkud checkbox */
        }

        #labels-checkbox:checked {
            background-color: #555;
            border: 2px solid #555;
        }

        #labels-checkbox:checked::after {
            content: '\2713';
            font-size: 14px;
            display: block;
            text-align: center;
            color: white;
            line-height: 18px;
        }
      .audio-button i {
            font-size: 20px;
            color: white;
            transition: color 0.3s ease;
        }
        .audio-button:hover i {
            color: #ff6600; /* Change color on hover */
        }
      .audio-button.backside i {
            color: #333; /* Dark color for better visibility on white background */
            font-size: 20px;
            transition: color 0.3s ease;
        }

        .audio-button.backside:hover i {
            color: #ff6600; /* Change color on hover */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Alef&family=Varela+Round&family=Noto+Rashi&subset=hebrew&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Hadasim CLM';
            src: url('fonts/HadasimCLMRegular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'Noto Serif';
            src: url('https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,400;0,700;1,400;1,700&subset=hebrew&display=swap');
            font-weight: normal;
            font-style: bold;
            font-display: swap;
        }
        @font-face {
            font-family: 'CustomHebrewFont';
            src: url('fonts/DanaYadAlefAlefAlef-Normal.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'CustomTTFHebrewFont';
            src: url('fonts/Gveret Levin AlefAlefAlef Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'Frank Ruehl CLM';
            src: url('fonts/FrankRuehlCLM-Medium.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            unicode-range: U+0590-05FF;
            font-display: swap;
        }
        @font-face {
            font-family: 'Noto Rashi';
            src: url('fonts/NotoRashiHebrew-VariableFont_wght.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'DorianCLM-BookItalic';
            src: url('fonts/DorianCLM-BookItalic.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'KtavYadCLM-MediumItalic';
            src: url('fonts/KtavYadCLM-MediumItalic.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
    </style>
</head>
<body>
    <div class="top-controls">
        <div class="menu-container">
            <div class="menu-header"></div>
            <div class="menu-content">
                <div class="menu-item" id="lesson-menu">
                    <div class="menu-title">Words & Phrases</div>
                    <select id="lesson-select" class="submenu-select">
                        <option value="" disabled selected>-</option>
                    </select>
                </div>
                <div class="menu-item" id="shoresh-menu">
                    <div class="menu-title">שורש'ם</div>
                    <select id="shoresh-select" class="submenu-select">
                        <option value="" disabled selected>-</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="font-and-checkbox">
            <select id="font-select">
                <option value="font-default" selected>Sans-serif</option>
                <option value="font-alef">Sans-serif 2</option>
                <option value="font-varela">Sans-serif 3</option>
                <option value="font-custom">Script 1</option>
                <option value="font-custom-ttf">Script 2</option>
                <option value="font-dorian">Script 3</option>
                <option value="font-ktavyad">Script 4</option>
                <option value="font-hadasim">Serif 1</option>
                <option value="font-nikkud">Serif 2</option>
                <option value="font-rashi">Noto Rashi</option>
            </select>
            <div class="checkbox-stack">
            <div class="checkbox-inline">
                <label for="nikkud-checkbox">Nikkud</label>
                <input type="checkbox" id="nikkud-checkbox">
            </div>
            <div class="checkbox-inline">
                <label for="labels-checkbox">Labels</label>
                <input type="checkbox" id="labels-checkbox">
            </div>
        </div>
        </div>
    </div>
    
    <div class="flashcard-container" id="flashcard-container">
        <div class="flashcard" id="flashcard">
            <div class="flashcard-side flashcard-front font-default" id="front">
            <button class="audio-button" id="play-audio">
                <i class="icon ion-md-volume-high"></i>
            </button>
            </div>
            <div class="flashcard-side flashcard-back font-default" id="back">
            <img id="back-image" src="" alt="Hebrew Letter" style="max-width: 100%; height: auto; margin-bottom: 10px; display: none;">
            <!-- Your existing content here -->
        </div>
        </div>
    </div>
    <div class="navigation">
        <button class="nav-button" id="prev-button">Previous</button>
        <button class="nav-button" id="flip-button">Flip</button>
        <button class="nav-button" id="next-button">Next</button>
        <button class="nav-button" id="random-button">Random</button>
        <button class="nav-button" id="random-all-button">Random All</button>
    </div>
    <div class="progress" id="progress"></div>
  	
    <div class="font-size-controls">
        <a href="mailto:admin@alephbetical.com" title="שלום">
            <button class="email-button" aria-label="Email Admin">✉️</button>
        </a>
        <button class="font-size-button" id="font-size-decrease">-</button>
        <button class="font-size-button" id="font-size-increase">+</button>
        <input type="color" id="color-picker" value="#004e94">
        <input type="text" id="search-input" placeholder="Search by English or Hebrew...">
        <button id="search-button">Search</button>
    </div>
    <div class="word-list" id="word-list"></div>
    <script src="data.js"></script>
    <script src="data2.js"></script>
 <script>
// JavaScript Code for Flashcard Functionality
let currentLesson = null;
let currentShoresh = null;
let currentCardIndex = 0;
let isNavigating = false;

// Get DOM elements
const lessonMenu = document.getElementById('lesson-menu');
const shoreshMenu = document.getElementById('shoresh-menu');
const lessonSelect = document.getElementById('lesson-select');
const shoreshSelect = document.getElementById('shoresh-select');
const menuHeader = document.querySelector('.menu-header');
const menuContent = document.querySelector('.menu-content');
const flashcard = document.getElementById('flashcard');
const front = document.getElementById('front');
const back = document.getElementById('back');
const prevButton = document.getElementById('prev-button');
const nextButton = document.getElementById('next-button');
const flipButton = document.getElementById('flip-button');
const progress = document.getElementById('progress');
const fontSelect = document.getElementById('font-select');
const nikkudCheckbox = document.getElementById('nikkud-checkbox');
const wordListContainer = document.getElementById('word-list');

// Populate the lesson selection dropdown without sorting
function populateLessonSelect() {
    Object.keys(lessonsData).forEach((lesson, index) => {
        const option = document.createElement('option');
        option.value = lesson;
        option.textContent = lesson;
        lessonSelect.appendChild(option);
        if (index === 0) {
            option.selected = true;
            currentLesson = lesson;
        }
    });
    updateFlashcard();
    updateMenuHeader();
}

// Populate the shoresh selection dropdown without sorting
function populateShoreshSelect() {
    const sortedShoreshim = Object.keys(shoreshData).sort((a, b) => a.localeCompare(b, 'he', { sensitivity: 'base' }));
    sortedShoreshim.forEach((shoresh, index) => {
        const option = document.createElement('option');
        option.value = shoresh;
        option.textContent = shoresh;
        shoreshSelect.appendChild(option);
        if (index === 0) {
            option.selected = true;
            currentShoresh = shoresh;
        }
    });
}

// Update menu header based on selection
function updateMenuHeader() {
    menuHeader.textContent = currentLesson || currentShoresh || 'Select Category';
    if (currentLesson) {
        lessonSelect.value = currentLesson;
    } else if (currentShoresh) {
        shoreshSelect.value = currentShoresh;
    }
}

// Reset the other dropdown when one is selected
function resetOtherDropdown(selectedDropdown) {
    if (selectedDropdown === lessonSelect) {
        shoreshSelect.selectedIndex = 0;
    } else {
        lessonSelect.selectedIndex = 0;
    }
}

// Navigation function
function navigate(direction) {
    if (isNavigating) return;
    isNavigating = true;
    
    let cardsArray = currentLesson ? lessonsData[currentLesson] : (currentShoresh ? shoreshData[currentShoresh] : []);
    
    if (cardsArray && cardsArray.length > 0) {
        // First, check if the card is flipped and unflip it
        if (flashcard.classList.contains('flipped')) {
            flashcard.classList.remove('flipped');
            // Wait for the flip animation to finish before updating content
            setTimeout(() => {
                currentCardIndex = (currentCardIndex + direction + cardsArray.length) % cardsArray.length;
                if (currentCardIndex < 0) {
                    currentCardIndex = cardsArray.length - 1;
                }
                updateFlashcard();
                updateMenuHeader();
                generateWordList();
                // Reset isNavigating flag after the update
                isNavigating = false;
            }, 600); // 600ms matches the transition duration of the flip animation
        } else {
            currentCardIndex = (currentCardIndex + direction + cardsArray.length) % cardsArray.length;
            if (currentCardIndex < 0) {
                currentCardIndex = cardsArray.length - 1;
            }
            updateFlashcard();
            updateMenuHeader();
            generateWordList();
            // Reset isNavigating flag
            isNavigating = false;
        }
    } else {
        // Reset isNavigating flag if there are no cards
        isNavigating = false;
    }
}

// Function to generate a slightly varied color
function getRandomColorVariation(baseColor, variance = 10) {
    let R = parseInt(baseColor.substring(1,3),16);
    let G = parseInt(baseColor.substring(3,5),16);
    let B = parseInt(baseColor.substring(5,7),16);
    
    R = Math.max(0, Math.min(255, R + (Math.random() * variance * 2 - variance)));
    G = Math.max(0, Math.min(255, G + (Math.random() * variance * 2 - variance)));
    B = Math.max(0, Math.min(255, B + (Math.random() * variance * 2 - variance)));
    
    const RR = Math.round(R).toString(16).padStart(2, '0');
    const GG = Math.round(G).toString(16).padStart(2, '0');
    const BB = Math.round(B).toString(16).padStart(2, '0');
    
    return `#${RR}${GG}${BB}`;
}

let labelsCheckbox = document.getElementById('labels-checkbox');
let showLabels = false; // Default to off

labelsCheckbox.addEventListener('change', () => {
    showLabels = labelsCheckbox.checked;
    updateFlashcard(); // Re-render the back of the card with or without labels
});

function updateFlashcard() {
    let cardsArray = currentLesson ? lessonsData[currentLesson] : (currentShoresh ? shoreshData[currentShoresh] : []);
    if (!cardsArray || cardsArray.length === 0) {
        front.innerHTML = '<div>No flashcards available for this selection.</div>';
        back.innerHTML = '<div>No flashcards available for this selection.</div>';
        progress.textContent = 'Card 0 of 0';
        return;
    }
    const card = cardsArray[currentCardIndex];
    let hebrewText = nikkudCheckbox.checked ? card.hebrew : (card.hebrew_no_vowels || card.hebrew);
    
    // Front side
    front.innerHTML = `<div class="hebrew-text">${hebrewText}</div>`;
    
    // Add audio button to front
    front.innerHTML += `<button class="audio-button" id="play-audio" style="position: absolute; right: 10px; top: 10px; background: none; border: none; cursor: pointer; color: white; font-size: 20px;"><i class="icon ion-md-volume-high"></i></button>`;

    // Set up audio for the front side
    let frontAudioButton = document.getElementById('play-audio');
    if (card.audio) {
        frontAudioButton.style.display = 'block'; // Show button if audio exists
        frontAudioButton.addEventListener('click', function(e) {
            e.stopPropagation(); // Prevent click from flipping the card
            let audio = new Audio(card.audio);
            audio.play();
        });
    } else {
        frontAudioButton.style.display = 'none'; // Hide button if no audio
    }
    
    // Color variation (existing code)
    const baseMainColor = getComputedStyle(document.documentElement).getPropertyValue('--main-color').trim();
    const baseDarkerColor = getComputedStyle(document.documentElement).getPropertyValue('--darker-color').trim();
    const variedMainColor = getRandomColorVariation(baseMainColor);
    const variedDarkerColor = getRandomColorVariation(baseDarkerColor);

    document.documentElement.style.setProperty('--main-color', variedMainColor);
    document.documentElement.style.setProperty('--darker-color', variedDarkerColor);

    // Force a reflow to ensure the gradient updates
    front.style.display = 'none';
    front.offsetHeight; // Trigger reflow
    front.style.display = '';
    
    let backContent = '';
    
    // Add image only if the card has an image field
    if (card.hasOwnProperty('image')) {
        backContent += `<img id="back-image" src="${card.image}" alt="${card.english || 'Hebrew Letter'}" style="max-width: 100%; height: auto; margin-bottom: 10px;">`;
    }

    // Add Hebrew text to the back with optional label
    if (showLabels) {
        backContent += `<div>Hebrew: <strong class="hebrew-text">${hebrewText}</strong></div>`;
    } else {
        backContent += `<div class="hebrew-text">${hebrewText}</div>`;
    }

    // Add content based on whether labels are shown or not
    if (showLabels) {
        if (card.english) {
            backContent += `<div>English: <strong>${card.english}</strong></div>`;
        }
        if (card.pronunciation) {
            backContent += `<div>Pronunciation: <strong>${card.pronunciation}</strong></div>`;
        }
        if (card.Binyan) {
            backContent += `<div>Binyan: <strong>${card.Binyan}</strong></div>`;
        }
        if (card["Binyan Hebrew"]) {
            backContent += `<div>בניין: <strong>${card["Binyan Hebrew"]}</strong></div>`;
        }
    } else {
        // Show content without labels, only pronunciation is bolded
        if (card.english) {
            backContent += `<div>${card.english}</div>`;
        }
        if (card.pronunciation) {
            backContent += `<div><strong>${card.pronunciation}</strong></div>`;
        }
        if (card.Binyan) {
            backContent += `<div>${card.Binyan}</div>`;
        }
        if (card["Binyan Hebrew"]) {
            backContent += `<div>${card["Binyan Hebrew"]}</div>`;
        }
    }

    // For sentence and its translation, add audio button if audio2 exists
    if (card.sentence) {
        let hebrewSentence = card.sentence;
        let punctuation = '';
        if (hebrewSentence.endsWith('.') || hebrewSentence.endsWith('!') || hebrewSentence.endsWith('?')) {
            punctuation = hebrewSentence.slice(-1);
            hebrewSentence = hebrewSentence.slice(0, -1);
        }

        // Create audio button if audio2 is present
        let sentenceAudioButton = '';
        if (card.audio2) {
            sentenceAudioButton = `<button class="audio-button backside" id="play-sentence-audio" style="background: none; border: none; cursor: pointer; font-size: 20px;"><i class="icon ion-md-volume-high"></i></button>`;
        }

        backContent += `
        <div class="usage-hebrew" dir="rtl">
            ${showLabels ? 'דוגמה: ' : ''}${showLabels ? `<strong>${hebrewSentence}</strong>` : hebrewSentence}${punctuation}
            ${card.sentence2 ? `<div class="usage-english" dir="ltr">${showLabels ? 'Example: ' : ''}${showLabels ? `<strong>${card.sentence2}</strong>` : card.sentence2}</div>` : ''}
            ${sentenceAudioButton}
        </div>
    `;
    }

    // Update back content
    back.innerHTML = backContent;

    // Attach event listener for the sentence audio button if it exists
    if (card.audio2) {
        const sentenceAudioBtn = document.getElementById('play-sentence-audio');
        if (sentenceAudioBtn) {
            sentenceAudioBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent the card from flipping
                let audio = new Audio(card.audio2);
                audio.play();
            });
        }
    }

    progress.textContent = `Card ${currentCardIndex + 1} of ${cardsArray.length}`;
}

// Function to generate word list
function generateWordList() {
    // Clear previous content
    wordListContainer.innerHTML = '';
    
    let cardsArray = currentLesson ? lessonsData[currentLesson] : (currentShoresh ? shoreshData[currentShoresh] : []);
    
    if (cardsArray && cardsArray.length > 0) {
        // Generate word list with clickable spans
        const wordList = cardsArray.map((card, index) => {
            const word = card.hebrew_no_vowels || card.hebrew.replace(/[\u0591-\u05C7]/g, '');
            return `<span style="cursor: pointer; color: #888;" onclick="loadCard(${index})">${word}</span>`;
        }).join(', ');
        
        // Display the list in a justified paragraph
        wordListContainer.innerHTML = `<p style="text-align: justify; text-justify: inter-word; direction: rtl;">${wordList}</p>`;
    } else {
        wordListContainer.innerHTML = '<p style="color: #888;">No words available for this selection.</p>';
    }
}

// Event listeners
document.getElementById('flip-button').addEventListener('click', () => flashcard.classList.toggle('flipped'));
document.getElementById('next-button').addEventListener('click', () => navigate(1));
document.getElementById('prev-button').addEventListener('click', (e) => { e.stopPropagation(); navigate(-1); });

lessonSelect.addEventListener('change', (e) => {
    currentLesson = e.target.value;
    currentShoresh = null;
    currentCardIndex = 0;
    flashcard.classList.remove('flipped');
    updateFlashcard();
    updateMenuHeader();
    menuContent.style.display = 'none';
    menuIsOpen = false;
    resetOtherDropdown(lessonSelect);
    generateWordList();
});

shoreshSelect.addEventListener('change', (e) => {
    currentShoresh = e.target.value;
    currentLesson = null;
    currentCardIndex = 0;
    flashcard.classList.remove('flipped');
    updateFlashcard();
    updateMenuHeader();
    menuContent.style.display = 'none';
    menuIsOpen = false;
    resetOtherDropdown(shoreshSelect);
    generateWordList();
});

document.getElementById('random-button').addEventListener('click', () => {
    if (currentLesson || currentShoresh) {
        const cardsArray = currentLesson ? lessonsData[currentLesson] : shoreshData[currentShoresh];
        if (cardsArray && cardsArray.length > 0) {
            // If the card is already flipped, flip it back first
            if (flashcard.classList.contains('flipped')) {
                flashcard.classList.remove('flipped');
                // Wait for the flip animation to finish before selecting a new random card
                setTimeout(() => {
                    currentCardIndex = Math.floor(Math.random() * cardsArray.length);
                    updateFlashcard();
                    generateWordList();
                }, 600); // 600ms matches the transition duration of the flip animation
            } else {
                currentCardIndex = Math.floor(Math.random() * cardsArray.length);
                updateFlashcard();
                generateWordList();
            }
        }
    }
});

document.getElementById('random-all-button').addEventListener('click', () => {
    const allCards = [...Object.values(lessonsData).flat(), ...Object.values(shoreshData).flat()];
    if (allCards.length > 0) {
        const randomCard = allCards[Math.floor(Math.random() * allCards.length)];
        let sourceName, isLesson = false;

        for (const [source, cards] of [...Object.entries(lessonsData), ...Object.entries(shoreshData)]) {
            if (cards.includes(randomCard)) {
                sourceName = source;
                isLesson = Object.keys(lessonsData).includes(source);
                break;
            }
        }

        currentLesson = null;
        currentShoresh = null;

        if (isLesson) {
            currentLesson = sourceName;
            lessonSelect.value = sourceName;
            shoreshSelect.selectedIndex = 0;
        } else {
            currentShoresh = sourceName;
            shoreshSelect.value = sourceName;
            lessonSelect.selectedIndex = 0;
        }

        if (flashcard.classList.contains('flipped')) {
            flashcard.classList.remove('flipped');
            // Wait for the flip animation to finish before updating the card
            setTimeout(() => {
                const cardsArray = isLesson ? lessonsData[currentLesson] : shoreshData[currentShoresh];
                currentCardIndex = cardsArray.indexOf(randomCard);
                if (currentCardIndex === -1) {
                    console.error('Card not found in selected source:', sourceName);
                    return;
                }
                updateFlashcard();
                updateMenuHeader();
                generateWordList();
            }, 600); // 600ms matches the transition duration of the flip animation
        } else {
            const cardsArray = isLesson ? lessonsData[currentLesson] : shoreshData[currentShoresh];
            currentCardIndex = cardsArray.indexOf(randomCard);
            if (currentCardIndex === -1) {
                console.error('Card not found in selected source:', sourceName);
                return;
            }
            updateFlashcard();
            updateMenuHeader();
            generateWordList();
        }
    }
});

// Event listener for font selection
fontSelect.addEventListener('change', (e) => applyFont(e.target.value));

// Function to apply font to flashcard
function applyFont(font) {
    ['font-default', 'font-alef', 'font-noto', 'font-varela', 'font-custom', 'font-custom-ttf', 'font-nikkud', 'font-rashi', 'font-dorian', 'font-ktavyad', 'font-hadasim'].forEach(cls => {
        front.classList.remove(cls);
        back.classList.remove(cls);
    });
    front.classList.add(font);
    back.classList.add(font);
}

// Nikkud checkbox change event
nikkudCheckbox.addEventListener('change', updateFlashcard);

// Font size controls
document.getElementById('font-size-decrease').addEventListener('click', () => {
    if (flashcard.classList.contains('flipped')) {
        // Adjust back when flipped
        let currentBackSize = parseInt(window.getComputedStyle(back).fontSize);
        let newBackSize = Math.max(10, currentBackSize - 4);
        back.style.fontSize = newBackSize + 'px';
    } else {
        // Adjust only the front when not flipped
        let currentFrontSize = parseInt(window.getComputedStyle(front).fontSize);
        let newFrontSize = Math.max(10, currentFrontSize - 8);
        front.style.fontSize = newFrontSize + 'px';
    }
});

document.getElementById('font-size-increase').addEventListener('click', () => {
    if (flashcard.classList.contains('flipped')) {
        // Adjust back when flipped
        let currentBackSize = parseInt(window.getComputedStyle(back).fontSize);
        let newBackSize = Math.min(100, currentBackSize + 4);
        back.style.fontSize = newBackSize + 'px';
    } else {
        // Adjust only the front when not flipped
        let currentFrontSize = parseInt(window.getComputedStyle(front).fontSize);
        let newFrontSize = Math.min(100, currentFrontSize + 8);
        front.style.fontSize = newFrontSize + 'px';
    }
});
   
   
   
   
// Color picker functionality
document.addEventListener('DOMContentLoaded', () => {
    const colorPicker = document.getElementById('color-picker');
    colorPicker.addEventListener('change', (event) => {
        const color = event.target.value;
        const darkerColor = darkenColor(color, 50);

        document.documentElement.style.setProperty('--main-color', color);
        document.documentElement.style.setProperty('--darker-color', darkerColor);
    });
});

// Function to darken a color
function darkenColor(color, percent) {
    let R = parseInt(color.substring(1,3),16);
    let G = parseInt(color.substring(3,5),16);
    let B = parseInt(color.substring(5,7),16);

    R = parseInt(R * (100 - percent) / 100);
    G = parseInt(G * (100 - percent) / 100);
    B = parseInt(B * (100 - percent) / 100);

    R = Math.min(R, 255);
    G = Math.min(G, 255);
    B = Math.min(B, 255);

    const RR = (R.toString(16).length == 1) ? "0" + R.toString(16) : R.toString(16);
    const GG = (G.toString(16).length == 1) ? "0" + G.toString(16) : G.toString(16);
    const BB = (B.toString(16).length == 1) ? "0" + B.toString(16) : B.toString(16);

    return "#" + RR + GG + BB;
}
   // Function to generate a slightly varied color
function getRandomColorVariation(baseColor, variance = 10) {
    let R = parseInt(baseColor.substring(1,3),16);
    let G = parseInt(baseColor.substring(3,5),16);
    let B = parseInt(baseColor.substring(5,7),16);
    
    R = Math.max(0, Math.min(255, R + (Math.random() * variance * 2 - variance)));
    G = Math.max(0, Math.min(255, G + (Math.random() * variance * 2 - variance)));
    B = Math.max(0, Math.min(255, B + (Math.random() * variance * 2 - variance)));
    
    const RR = Math.round(R).toString(16).padStart(2, '0');
    const GG = Math.round(G).toString(16).padStart(2, '0');
    const BB = Math.round(B).toString(16).padStart(2, '0');
    
    return `#${RR}${GG}${BB}`;
}

function loadCard(index) {
    currentCardIndex = index;
    flashcard.classList.remove('flipped');
    updateFlashcard();
}
// Search functionality
const searchInput = document.getElementById('search-input');
const searchButton = document.getElementById('search-button');

function searchCardsByEnglishOrHebrew(query) {
    console.log("Searching for:", query);
    const allCards = [...Object.values(lessonsData).flat(), ...Object.values(shoreshData).flat()]
                      .filter(card => ('english' in card && card.english !== undefined) || ('hebrew' in card && card.hebrew !== undefined));
    console.log("Total valid cards to search:", allCards.length);

    // Normalize the query for both English and Hebrew comparison
    const queryLower = query.toLowerCase();

    function scoreMatch(card) {
        let score = 0;
        // Check English
        if ('english' in card) {
            const cardEnglishLower = card.english.toLowerCase();
            score += cardEnglishLower.startsWith(queryLower) ? 100 : (cardEnglishLower.includes(queryLower) ? 10 : 0);
        }
        // Check Hebrew - assuming 'hebrew' includes nikkud
        if ('hebrew' in card) {
            // Remove nikkud for better matching if needed
            const hebrewWithoutNikkud = card.hebrew.replace(/[\u0591-\u05C7]/g, '');
            const cardHebrewLower = hebrewWithoutNikkud.toLowerCase();
            score += cardHebrewLower.startsWith(queryLower) ? 100 : (cardHebrewLower.includes(queryLower) ? 10 : 0);
        }
        return score;
    }

    const results = allCards
        .map(card => ({ ...card, score: scoreMatch(card) }))
        .filter(card => card.score > 0)
        .sort((a, b) => b.score - a.score);

    if (results.length > 0) {
        const highestScore = results[0].score;
        const topMatches = results.filter(card => card.score === highestScore);
        const randomResult = topMatches[Math.floor(Math.random() * topMatches.length)];

        let sourceName, isLesson;
        for (const [source, cards] of [...Object.entries(lessonsData), ...Object.entries(shoreshData)]) {
            if (cards.some(c => (c.english === randomResult.english) || (c.hebrew === randomResult.hebrew))) {
                sourceName = source;
                isLesson = Object.keys(lessonsData).includes(source);
                break;
            }
        }

        if (isLesson) {
            currentLesson = sourceName;
            lessonSelect.value = sourceName;shoreshSelect.selectedIndex = 0;
        } else {
            currentShoresh = sourceName;
            shoreshSelect.value = sourceName;
            lessonSelect.selectedIndex = 0;
        }

        const cardSet = isLesson ? lessonsData[currentLesson] : shoreshData[currentShoresh];
        currentCardIndex = cardSet.findIndex(c => (c.english === randomResult.english) || (c.hebrew === randomResult.hebrew));

        updateFlashcard();
        updateMenuHeader();
        progress.textContent = `Search Result: Card 1 of ${topMatches.length} matches`;
        generateWordList();
    } else {
        console.log("No matches found after filtering for 'english' or 'hebrew' property.");
        front.innerHTML = '<div>No cards found matching your search.</div>';
        back.innerHTML = '<div>No cards found matching your search.</div>';
        progress.textContent = 'No Results';
        currentLesson = null;
        currentShoresh = null;
        updateMenuHeader();
        generateWordList();
    }
}

searchButton.addEventListener('click', () => {
    const query = searchInput.value.trim();
    if (query) searchCardsByEnglishOrHebrew(query);
});

searchInput.addEventListener('keyup', (e) => {
    if (e.key === 'Enter') searchButton.click();
});

// Keyboard navigation
document.addEventListener('keydown', function(event) {
    switch(event.code) {
        case 'ArrowLeft':
            event.preventDefault();
            prevButton.click();
            break;
        case 'ArrowRight':
            event.preventDefault();
            nextButton.click();
            break;
        case 'ArrowDown':
            event.preventDefault();
            document.getElementById('random-button').click();
            break;
        case 'ArrowUp':
            event.preventDefault();
            document.getElementById('random-all-button').click();
            break;
        case 'Enter':
            // Prevent the default action of the Enter key if needed
            event.preventDefault();
            // Flip the card when Enter is pressed
            flipButton.click();
            break;
    }
});
document.addEventListener('keydown', (event) => {
    if (event.code === 'Space') {
        event.preventDefault(); // Prevents the page from scrolling or other default actions
        const audioButton = document.getElementById('play-audio');
        if (audioButton.style.display !== 'none') {
            audioButton.click(); // Trigger the click event on the audio button if it's visible
        }
    }
});
   
// Menu functionality
let menuIsOpen = false;
menuHeader.addEventListener('mouseover', () => {
    if (!menuIsOpen) {
        menuContent.style.display = 'block';
        lessonSelect.style.display = 'block';
        shoreshSelect.style.display = 'block';
        menuIsOpen = true;
    }
});

document.addEventListener('click', (e) => {
    if (!menuContent.contains(e.target) && e.target !== menuHeader) {
        menuContent.style.display = 'none';
        lessonSelect.style.display = 'none';
        shoreshSelect.style.display = 'none';
        menuIsOpen = false;
    }
});

// Initialize everything on page load
window.onload = () => {
    populateLessonSelect();
    populateShoreshSelect();
    updateMenuHeader();
    updateFlashcard();
    applyFont('font-default');
};

// Ensure that clicking the flashcard flips it, unless clicking an audio button
flashcard.addEventListener('click', (e) => {
    if (e.target.id !== 'play-audio' && e.target.id !== 'play-sentence-audio') {
        if (currentLesson || currentShoresh) {
            flashcard.classList.toggle('flipped');
        }
    }
});


</script>
</body>
</html>
